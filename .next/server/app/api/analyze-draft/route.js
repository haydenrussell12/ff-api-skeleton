"use strict";(()=>{var e={};e.id=47,e.ids=[47],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},260:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>P,patchFetch:()=>D,requestAsyncStorage:()=>g,routeModule:()=>h,serverHooks:()=>y,staticGenerationAsyncStorage:()=>m});var a={};r.r(a),r.d(a,{GET:()=>f,POST:()=>u,runtime:()=>c});var o=r(9303),s=r(8716),l=r(670),n=r(7070);class i{getRosterRequirements(e="standard",t=0){let r={standard:{QB:1,RB:2,WR:2,TE:1,FLEX:1,K:1,DEF:1,totalStarters:9,flexPositions:["RB","WR","TE"],superflexSlots:0},superflex:{QB:1,RB:2,WR:2,TE:1,FLEX:1,SUPERFLEX:t||1,K:1,DEF:1,totalStarters:9+(t||1),flexPositions:["RB","WR","TE"],superflexPositions:["QB","RB","WR","TE"],superflexSlots:t||1},"2qb":{QB:2,RB:2,WR:2,TE:1,FLEX:1,K:1,DEF:1,totalStarters:10,flexPositions:["RB","WR","TE"],superflexSlots:0}};return r[e]||r.standard}calculateOptimalLineup(e,t={}){let r=t.leagueType||"standard",a=t.superflexSlots||0,o=this.getRosterRequirements(r,a),s=this.groupPlayersByPosition(e),l={},n=new Set;if(Object.entries(o).forEach(([e,t])=>{if("totalStarters"!==e&&"flexPositions"!==e&&"superflexPositions"!==e&&"superflexSlots"!==e&&"number"==typeof t&&t>0){l[e]=[];let r=(s[e]||[]).filter(e=>!n.has(e.playerId||e.playerName)).sort((e,t)=>(t.projectedPoints||0)-(e.projectedPoints||0)).slice(0,t);l[e]=r,r.forEach(e=>n.add(e.playerId||e.playerName))}}),o.flexPositions){let e=o.flexPositions.flatMap(e=>(s[e]||[]).filter(e=>!n.has(e.playerId||e.playerName)));if(e.length>0){let t=e.sort((e,t)=>(t.projectedPoints||0)-(e.projectedPoints||0))[0];t&&(l.FLEX=[t],n.add(t.playerId||t.playerName))}}if("superflex"===r&&o.superflexSlots&&o.superflexSlots>0){l.SUPERFLEX=[];for(let e=0;e<o.superflexSlots;e++){let t=this.findBestSuperflexPlayer(s,n);t&&(l.SUPERFLEX.push(t),n.add(t.playerId||t.playerName),console.log(`ü¶∏ SUPERFLEX Slot ${e+1}: Selected ${t.position} ${t.playerName} with ${t.projectedPoints} points`))}}return l}findBestSuperflexPlayer(e,t){let r=(e.QB||[]).filter(e=>!t.has(e.playerId||e.playerName)),a=(e.RB||[]).filter(e=>!t.has(e.playerId||e.playerName)),o=(e.WR||[]).filter(e=>!t.has(e.playerId||e.playerName)),s=(e.TE||[]).filter(e=>!t.has(e.playerId||e.playerName)),l=null;if(r.length>0&&(l=r.sort((e,t)=>(t.projectedPoints||0)-(e.projectedPoints||0))[0]),!l){let e=[...a,...o,...s];e.length>0&&(l=e.sort((e,t)=>(t.projectedPoints||0)-(e.projectedPoints||0))[0])}return l}groupPlayersByPosition(e){let t={};return e.forEach(e=>{let r=(e.position||"").toUpperCase();r&&(t[r]||(t[r]=[]),t[r].push(e))}),t}getBenchPlayers(e,t){let r=new Set;return Object.values(t).forEach(e=>{Array.isArray(e)&&e.forEach(e=>{r.add(e.playerId||e.playerName)})}),e.filter(e=>!r.has(e.playerId||e.playerName))}calculateTotalProjectedPoints(e){if(Array.isArray(e))return e.reduce((e,t)=>e+(t.projectedPoints||0),0);let t=0;return Object.values(e).forEach(e=>{Array.isArray(e)&&(t+=e.reduce((e,t)=>e+(t.projectedPoints||0),0))}),t}analyzeLineup(e,t={}){let r=t.leagueType||"standard",a=t.superflexSlots||0,o=this.getRosterRequirements(r,a);return{totalStarters:o.totalStarters,leagueType:r,superflexSlots:o.superflexSlots||0,requirements:o,positionCounts:Object.entries(o).filter(([e])=>!["totalStarters","flexPositions","superflexPositions","superflexSlots"].includes(e)).reduce((e,[t,r])=>({...e,[t]:r}),{})}}calculateReplacementBaselines(e={}){e.leagueType;let t=e.superflexSlots||0,r=e.teams||12;return{QB:r*(1+t),RB:2*r,WR:2*r,TE:1*r,K:1*r,DEF:1*r}}}class p{constructor(e=[]){this.vorpLookup={},this.leagueAverages={},this.leagueStdDevs={},e.forEach(e=>{let t=(e.playerName||"").toLowerCase(),r=e.vorpScore??e.vorp_score??0;t&&(this.vorpLookup[t]=Number(r))})}calculatePositionGrades(e,t={}){let r=t.leagueType||"standard",a=t.superflexSlots||0,o=this.getPositionRequirements(r,a);return e.map(e=>{let t=this.calculateTeamPositionGrades(e,o);return{...e,positionGrades:t}}).map(e=>{let t=e.optimalLineupPoints||0,r=this.scoreToGrade(t);return{...e,overallGrade:{grade:r,score:t,rawScore:t}}})}calculateTeamPositionGrades(e,t){let r={};return t.forEach(t=>{if("FLEX"===t||"SUPERFLEX"===t){let a=this.getFlexPlayers(e,t);if(a.length>0){let e=this.gradePositionSimple(a,t);r[t]=e}}else{let a=this.getPositionPlayers(e,t);if(a.length>0){let e=this.gradePositionSimple(a,t);r[t]=e}}}),r}gradePositionSimple(e,t){if(0===e.length)return{grade:"‚Äî",score:0,reason:"No players"};let r=e.reduce((e,t)=>e+(t.projectedPoints||0),0),a="C",o={QB:{excellent:25,good:22,average:18,poor:15},RB:{excellent:40,good:30,average:22,poor:15},WR:{excellent:40,good:30,average:22,poor:15},TE:{excellent:15,good:12,average:9,poor:6},FLEX:{excellent:20,good:15,average:12,poor:8},SUPERFLEX:{excellent:25,good:20,average:15,poor:10},K:{excellent:10,good:8,average:6,poor:4},DEF:{excellent:12,good:9,average:7,poor:5}},s=o[t]||o.FLEX;return{grade:a=r>=s.excellent?"A+":r>=s.good?"A":r>=s.average?"B":r>=s.poor?"C":"D",score:r,reason:this.generatePositionReason(a,0,t)}}getFlexPlayers(e,t){let r=[];return("SUPERFLEX"===t?["QB","RB","WR","TE"]:["RB","WR","TE"]).forEach(t=>{let a=this.getPositionPlayers(e,t);r.push(...a)}),r.sort((e,t)=>(t.projectedPoints||0)-(e.projectedPoints||0)).slice(0,3)}getPositionPlayers(e,t){return e.optimalLineup&&e.optimalLineup[t]&&e.optimalLineup[t]||[]}calculateOverallGrade(e,t,r={}){let a=r.leagueType||"standard";r.superflexSlots;let o={QB:"superflex"===a?1.4:1.2,RB:1,WR:1,TE:.9,FLEX:.8,SUPERFLEX:"superflex"===a?1.3:.8,K:.3,DEF:.4},s=0,l=0;if(Object.entries(t).forEach(([e,t])=>{if(t&&"‚Äî"!==t.grade){let r=o[e]||1,a=this.gradeToScore(t.grade);s+=a*r,l+=r}}),0===l)return{grade:"‚Äî",score:0};let n=s/l;return{grade:this.scoreToGrade(n),score:n,totalWeightedScore:s,totalWeight:l}}gradePosition(e,t){if(0===e.length)return{grade:"‚Äî",score:0,reason:"No players"};let r=e.reduce((e,t)=>e+(t.projectedPoints||0),0),a=e.reduce((e,t)=>e+(t.vorpScore||0),0)/e.length,o=this.leagueAverages[t]||0,s=this.leagueStdDevs[t]||1,l=s>0?(r-o)/s:0,n=this.zScoreToGrade(l);return{grade:n,score:r,zScore:l,avgVorp:a,reason:this.generatePositionReason(n,l,t)}}zScoreToGrade(e){return e>=1.5?"A+":e>=1?"A":e>=.5?"B+":e>=0?"B":e>=-.5?"C+":e>=-1?"C":e>=-1.5?"D+":e>=-2?"D":"F"}gradeToScore(e){return({"A+":95,A:90,"A-":85,"B+":80,B:75,"B-":70,"C+":65,C:60,"C-":55,"D+":50,D:45,"D-":40,F:30})[e]||50}scoreToGrade(e){return e>=200?"A+":e>=185?"A":e>=170?"A-":e>=155?"B+":e>=140?"B":e>=125?"B-":e>=110?"C+":e>=95?"C":e>=80?"C-":e>=65?"D+":e>=50?"D":"F"}generatePositionReason(e,t,r){return e.startsWith("A")?`Excellent ${r} performance`:e.startsWith("B")?`Good ${r} performance`:e.startsWith("C")?`Average ${r} performance`:e.startsWith("D")?`Below average ${r} performance`:`Poor ${r} performance`}calculateLeagueStats(e,t){let r={};t.forEach(e=>{r[e]={points:[],vorp:[]}}),e.forEach(e=>{(e.roster||[]).forEach(e=>{let t=(e.position||"").toUpperCase();if(!t||!r[t])return;let a=e.projectedPoints||0,o=this.getPlayerVorp(e.playerName||e.name||"");r[t].points.push(a),r[t].vorp.push(o)})}),Object.keys(r).forEach(e=>{let t=r[e].points.filter(e=>e>0),a=r[e].vorp.filter(e=>0!==e);t.length>0&&(this.leagueAverages[e]=t.reduce((e,t)=>e+t,0)/t.length,this.leagueStdDevs[e]=this.calculateStdDev(t,this.leagueAverages[e])),a.length>0&&(this.leagueAverages[`${e}_VORP`]=a.reduce((e,t)=>e+t,0)/a.length,this.leagueStdDevs[`${e}_VORP`]=this.calculateStdDev(a,this.leagueAverages[`${e}_VORP`]))})}calculateStdDev(e,t){return e.length<=1?0:Math.sqrt(e.reduce((e,r)=>e+Math.pow(r-t,2),0)/e.length)}getPlayerVorp(e){if(!e)return 0;let t=e.toLowerCase();return this.vorpLookup[t]||0}getPositionRequirements(e="standard",t=0){let r={standard:["QB","RB","WR","TE","FLEX","K","DEF"],superflex:["QB","RB","WR","TE","FLEX","SUPERFLEX","K","DEF"],"2qb":["QB","RB","WR","TE","FLEX","K","DEF"]};return r[e]||r.standard}calculateReplacementBaselines(e={}){e.leagueType;let t=e.superflexSlots||0,r=e.teams||12;return{QB:r*(1+t),RB:2*r,WR:2*r,TE:1*r,K:1*r,DEF:1*r}}}let c="nodejs";class d{async initialize(){try{console.log("\uD83D\uDE80 Initializing Draft Analyzer...");let[e,t,a,o]=await Promise.all([r.e(297).then(r.t.bind(r,9297,19)),r.e(266).then(r.t.bind(r,1266,19)),r.e(101).then(r.t.bind(r,101,19)),r.e(865).then(r.t.bind(r,5865,19))]);console.log("\uD83D\uDD0D Loaded modules:",{masterPlayers:!!e,nameLookup:!!t,vorpData:!!a,adpData:!!o});let s=e.default.players;console.log("\uD83D\uDD0D Master players structure:",{hasDefault:!!e.default,hasPlayers:!!s,playerCount:s?.length||0,samplePlayer:s?.[0]}),this.consolidatedData={},s.forEach(e=>{e.full_name&&(this.consolidatedData[e.full_name.toLowerCase()]=e,e.player_id&&(this.consolidatedData[e.player_id.toLowerCase()]=e))}),this.nameLookupIndex=t.default,this.vorpData=a.default.vorpScores||a.default,this.adpData={};let l=o.default.players||[];console.log("\uD83D\uDD0D ADP data structure:",{hasDefault:!!o.default,hasPlayers:!!l,playerCount:l?.length||0,samplePlayer:l?.[0]}),l.forEach(e=>{e.full_name&&(this.adpData[e.full_name.toLowerCase()]=e)}),console.log(`‚úÖ Draft Analyzer initialized with ${Object.keys(this.consolidatedData).length} players and ${Object.keys(this.adpData).length} ADP records.`),console.log(`üîç Sample consolidated players:`,Object.keys(this.consolidatedData).slice(0,5)),console.log(`üîç Sample ADP players:`,Object.keys(this.adpData).slice(0,5))}catch(e){throw console.error("‚ùå Failed to initialize Draft Analyzer:",e),Error("Failed to load necessary data for analysis.")}}async fetchSleeperApi(e){let t=await fetch(e);if(!t.ok)throw Error(`Failed to fetch from Sleeper API: ${t.statusText}`);return t.json()}parseSleeperDraftUrl(e){let t=e.match(/sleeper\.(?:com|app)\/draft\/nfl\/([a-zA-Z0-9]+)/);if(!t||!t[1])throw Error("Invalid Sleeper mock draft URL format. Expected format: https://sleeper.app/draft/nfl/{draft_id}");return t[1]}normalizePlayerName(e){return e?e.toLowerCase().replace(/\s+(jr\.?|sr\.?|ii|iii|iv|v|vi|vii|viii|ix|x)\s*$/i,"").replace(/\s+/g," ").trim():""}findPlayerByName(e,t){if(!e)return null;let r=this.normalizePlayerName(e);console.log(`üîç Looking for player: "${e}" -> normalized: "${r}"`);let a=this.consolidatedData[r];if(a)return console.log(`‚úÖ Found exact match: ${e}`),a;if(a=this.consolidatedData[e.toLowerCase()])return console.log(`‚úÖ Found exact match with original name: ${e}`),a;let o=r.split(" ");if(o.length>=2){let t=o[0],r=o[o.length-1];for(let[a,o]of(console.log(`üîç Trying fuzzy match: firstName="${t}", lastName="${r}"`),Object.entries(this.consolidatedData))){let s=a.split(" ");if(s.length>=2){let l=s[0],n=s[s.length-1];if(l===t&&n===r)return console.log(`‚úÖ Found fuzzy match: "${e}" -> "${a}"`),o}}}for(let[t,a]of Object.entries(this.consolidatedData))if(t.includes(r)||r.includes(t))return console.log(`‚úÖ Found partial match: "${e}" -> "${t}"`),a;return console.log(`‚ùå No match found for: ${e}`),console.log(`üîç Available players starting with similar names:`,Object.keys(this.consolidatedData).filter(e=>e.includes(r.split(" ")[0])).slice(0,5)),null}getPlayerProjectedPoints(e,t){let r=this.findPlayerByName(e,t);if(!r||!r.projections)return console.log(`‚ö†Ô∏è No player or projections found for: ${e} (${t})`),0;let a=t?.toLowerCase();console.log(`üîç Looking for projections for ${e} at position: ${a}`),console.log(`üîç Available projection keys:`,Object.keys(r.projections));let o=0;if("def"===a||"defense"===a){for(let t of(console.log(`üõ°Ô∏è Processing DEFENSE player: ${e}`),["def","DEF","defense","Defense","DEFENSE"]))if(r.projections[t]?.fpts){o=r.projections[t].fpts,console.log(`‚úÖ Found defense projections using key: ${t} = ${o}`);break}if(!o){for(let e of Object.keys(r.projections))if(e.toLowerCase().includes("def")){o=r.projections[e].fpts,console.log(`‚úÖ Found defense projections using partial key: ${e} = ${o}`);break}}if(!o)for(let e of Object.keys(r.projections)){let t=r.projections[e];if(t&&"object"==typeof t&&t.fpts){o=t.fpts,console.log(`‚úÖ Found defense projections using generic key: ${e} = ${o}`);break}}if(!o)for(let e of Object.keys(r.projections)){let t=r.projections[e];if("number"==typeof t&&t>0){o=t,console.log(`‚úÖ Found defense projections using numeric key: ${e} = ${o}`);break}}!o&&"number"==typeof r.projections&&r.projections>0&&(o=r.projections,console.log(`‚úÖ Found defense projections as direct number: ${o}`))}else o=r.projections[a]?.fpts;return o?(console.log(`‚úÖ Projected points for ${e}: ${o}`),"number"==typeof o?o:parseFloat(o)):(console.log(`‚ùå No projected points found for ${e} at position ${a}`),console.log(`üîç Player projections structure:`,r.projections),0)}getPlayerAdp(e){if(!this.findPlayerByName(e,""))return 0;let t=this.normalizePlayerName(e),r=this.adpData[t];if(!r){let e=t.split(" ");if(e.length>=2){let t=e[0],a=e[e.length-1];for(let[e,o]of Object.entries(this.adpData)){let s=e.split(" ");if(s.length>=2){let e=s[0],l=s[s.length-1];if(e===t&&l===a){r=o;break}}}}}let a=r?.adp_value;return a?parseFloat(a):0}getPlayerVorp(e){let t=this.normalizePlayerName(e);if(!t)return 0;let r=Array.isArray(this.vorpData)?this.vorpData.find(e=>this.normalizePlayerName(e.playerName||"")===t):void 0;return r?.vorp_score||r?.vorpScore?parseFloat(r.vorp_score||r.vorpScore):0}async analyzeDraft(e,t="standard",r){await this.initialize(),console.log("\uD83D\uDD0D Fetching draft data from Sleeper...");let a=this.parseSleeperDraftUrl(e),o=await this.fetchSleeperApi(`https://api.sleeper.app/v1/draft/${a}`),s=await this.fetchSleeperApi(`https://api.sleeper.app/v1/draft/${a}/picks`);console.log("\uD83D\uDCCA Draft data fetched:",{draftName:o.name,teams:o.teams?.length||0,rounds:o.settings?.rounds||0,picks:s?.length||0});let l=await this.buildTeamRosters(o,s),n=this.analyzeTeams(l,t,r);return{draftInfo:{name:o.name,teams:o.teams?.length||0,rounds:o.settings?.rounds||0,totalPicks:s?.length||0},...n}}analyzeTeams(e,t="standard",r){let a=new i,o=new p,s=Object.entries(e).map(([o,s])=>{let l=a.calculateOptimalLineup(s.roster,{leagueType:t,scoring:"ppr",superflexSlots:"superflex"===t?r:void 0,teams:Object.keys(e).length}),n=s.roster.map(e=>e.adpValue||0).filter(e=>0!==e),i=n.length>0?n.reduce((e,t)=>e+t,0)/n.length:0,p=s.roster.map(e=>e.vorpScore||0).filter(e=>0!==e),c=p.length>0?p.reduce((e,t)=>e+t,0)/p.length:0,d=a.calculateTotalProjectedPoints(l),u=a.getBenchPlayers(s.roster,l),f=a.calculateTotalProjectedPoints(u),h=a.analyzeLineup(l,{leagueType:t,scoring:"ppr",superflexSlots:"superflex"===t?r:void 0,teams:Object.keys(e).length});return{teamId:o,teamName:s.teamName,draftSlot:s.draftSlot,roster:s.roster,optimalLineup:l,optimalLineupPoints:d,benchPlayers:u,benchPoints:f,totalProjectedPoints:d+f,averageAdpValue:i,averageVorpScore:c,lineupAnalysis:h}});return{analysis:{teams:o.calculatePositionGrades(s,{leagueType:t,scoring:"ppr",superflexSlots:"superflex"===t?r:void 0,teams:Object.keys(e).length}).map(e=>{let t=s.find(t=>t.teamId===e.teamId);return{teamId:e.teamId,teamName:e.teamName,draftSlot:t?.draftSlot||0,optimalLineup:t?.optimalLineup||{},optimalLineupPoints:t?.optimalLineupPoints||0,benchPlayers:t?.benchPlayers||[],benchPoints:t?.benchPoints||0,positionGrades:e.positionGrades||{},overallGrade:e.overallGrade||{grade:"‚Äî",score:0},totalProjectedPoints:(t?.optimalLineupPoints||0)+(t?.benchPoints||0),averageProjectedPoints:t?.roster?.length?t.roster.reduce((e,t)=>e+(t.projectedPoints||0),0)/t.roster.length:0,averageAdpValue:t?.averageAdpValue||0,averageVorpScore:t?.averageVorpScore||0,players:t?.roster||[],roster:t?.roster||[]}})}}}async buildTeamRosters(e,t){let r=e.slot_to_roster_id;if(!r)throw Error("No slot_to_roster_id found in draft data - this may not be a mock draft");let a={};e.metadata?.draft_order_by_roster_id?Object.entries(e.metadata.draft_order_by_roster_id).forEach(([e,t])=>{a[t]=`Team ${parseInt(e)+1}`}):Object.keys(r).forEach(e=>{a[e]=`Team ${parseInt(e)+1}`});let o=await this.fetchSleeperApi("https://api.sleeper.app/v1/players/nfl"),s=e=>o?.[e],l={};return t.forEach(e=>{let t=e.pick_no.toString(),o=r[t];if(!o){console.warn(`No roster ID found for slot ${t}`);return}l[o]||(l[o]={teamId:o,teamName:a[t]||`Team ${o}`,draftSlot:parseInt(t),roster:[]});let n=s(e.player_id);if(!n){console.warn(`No player data found for ID ${e.player_id}`);return}let i=this.enhancePlayerData(n,e);l[o].roster.push(i)}),l}enhancePlayerData(e,t){let r=e.full_name||`${e.first_name||""} ${e.last_name||""}`.trim(),a=e.position||t.metadata?.position||"",o=this.getPlayerProjectedPoints(r,a),s=this.getPlayerAdp(r),l=this.getPlayerVorp(r),n=s>0?s-t.draft_slot:0;return{...t,metadata:e,playerName:r,position:a,projectedPoints:o,adpValue:s,vorpScore:l,draftValue:n,playerId:t.player_id}}constructor(){this.consolidatedData={},this.nameLookupIndex={},this.playerDetails={},this.vorpData={},this.adpData={}}}async function u(e){try{let{draftUrl:t,leagueType:r="standard",superflexSlots:a}=await e.json();if(!t)return n.NextResponse.json({success:!1,error:"Draft URL is required"});console.log("\uD83D\uDE80 Starting draft analysis..."),console.log("\uD83D\uDD0D Draft URL:",t),console.log("\uD83C\uDFC8 League Type:",r),console.log("\uD83E\uDDB8 Superflex Slots:",a);let o=new d;await o.initialize();let s=await o.analyzeDraft(t,r,a);return n.NextResponse.json({success:!0,data:s})}catch(e){return console.error("‚ùå Error in draft analysis:",e),n.NextResponse.json({success:!1,error:e instanceof Error?e.message:"Unknown error occurred"})}}function f(){return new Response("Method Not Allowed",{status:405,headers:{Allow:"POST"}})}let h=new o.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/analyze-draft/route",pathname:"/api/analyze-draft",filename:"route",bundlePath:"app/api/analyze-draft/route"},resolvedPagePath:"/Users/kanikameister/Documents/ff_api_skeleton/app/api/analyze-draft/route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:g,staticGenerationAsyncStorage:m,serverHooks:y}=h,P="/api/analyze-draft/route";function D(){return(0,l.patchFetch)({serverHooks:y,staticGenerationAsyncStorage:m})}}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[276,972],()=>r(260));module.exports=a})();